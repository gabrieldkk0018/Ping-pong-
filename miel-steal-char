--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer

--// Remove GUI antiga
if player.PlayerGui:FindFirstChild("MHStealCharacter") then
	player.PlayerGui.MHStealCharacter:Destroy()
end

--// ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MHStealCharacter"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player.PlayerGui

--// Main Frame (mobile friendly)
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0.85, 0, 0, 210)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(30,30,40)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 14)

--// RGB Border
local Border = Instance.new("Frame", MainFrame)
Border.Size = UDim2.new(1,0,1,0)
Border.BackgroundColor3 = Color3.new(1,1,1)
Instance.new("UICorner", Border).CornerRadius = UDim.new(0,14)

local Gradient = Instance.new("UIGradient", Border)
Gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255,0,0)),
	ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0,255,0)),
	ColorSequenceKeypoint.new(0.66, Color3.fromRGB(0,0,255)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(255,0,255)),
}

RunService.RenderStepped:Connect(function(dt)
	Gradient.Rotation = (Gradient.Rotation + dt*50) % 360
end)

--// Inner
local Inner = Instance.new("Frame", Border)
Inner.Size = UDim2.new(1,-6,1,-6)
Inner.Position = UDim2.new(0,3,0,3)
Inner.BackgroundColor3 = Color3.fromRGB(30,30,40)
Instance.new("UICorner", Inner).CornerRadius = UDim.new(0,12)

--// Title (drag here)
local Title = Instance.new("TextLabel", Inner)
Title.Size = UDim2.new(1,0,0,36)
Title.Text = "mh steal character"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.BackgroundColor3 = Color3.fromRGB(45,45,60)
Instance.new("UICorner", Title).CornerRadius = UDim.new(0,10)

--// Subtitle
local Subtitle = Instance.new("TextLabel", Inner)
Subtitle.Size = UDim2.new(1,-20,0,30)
Subtitle.Position = UDim2.new(0,10,0,40)
Subtitle.BackgroundTransparency = 1
Subtitle.TextWrapped = true
Subtitle.Text = "Type the person's nickname below."
Subtitle.Font = Enum.Font.Gotham
Subtitle.TextSize = 13
Subtitle.TextColor3 = Color3.fromRGB(200,200,200)

--// TextBox
local NameBox = Instance.new("TextBox", Inner)
NameBox.Size = UDim2.new(1,-40,0,34)
NameBox.Position = UDim2.new(0,20,0,78)
NameBox.PlaceholderText = "Username"
NameBox.ClearTextOnFocus = false
NameBox.Font = Enum.Font.Gotham
NameBox.TextSize = 13
NameBox.TextColor3 = Color3.fromRGB(255,255,255)
NameBox.BackgroundColor3 = Color3.fromRGB(50,50,65)
Instance.new("UICorner", NameBox).CornerRadius = UDim.new(0,8)

--// Button
local StealButton = Instance.new("TextButton", Inner)
StealButton.Size = UDim2.new(1,-40,0,36)
StealButton.Position = UDim2.new(0,20,0,120)
StealButton.Text = "Steal Char"
StealButton.Font = Enum.Font.GothamBold
StealButton.TextSize = 14
StealButton.TextColor3 = Color3.fromRGB(255,255,255)
StealButton.BackgroundColor3 = Color3.fromRGB(80,130,255)
Instance.new("UICorner", StealButton).CornerRadius = UDim.new(0,8)

--// Status
local Status = Instance.new("TextLabel", Inner)
Status.Size = UDim2.new(1,-20,0,22)
Status.Position = UDim2.new(0,10,1,-26)
Status.BackgroundTransparency = 1
Status.Font = Enum.Font.Gotham
Status.TextSize = 12
Status.Text = ""

--// STEAL FUNCTION (FIX REAL)
local function StealCharacter(username)
	Status.TextColor3 = Color3.fromRGB(200,200,200)
	Status.Text = "Copying skin..."

	local success, userId = pcall(function()
		return Players:GetUserIdFromNameAsync(username)
	end)
	if not success then
		Status.TextColor3 = Color3.fromRGB(255,120,120)
		Status.Text = "Invalid username"
		return
	end

	local success2, desc = pcall(function()
		return Players:GetHumanoidDescriptionFromUserId(userId)
	end)
	if not success2 then
		Status.TextColor3 = Color3.fromRGB(255,120,120)
		Status.Text = "Failed to get appearance"
		return
	end

	local char = player.Character or player.CharacterAdded:Wait()
	player.CharacterAppearanceLoaded:Wait()

	local hum = char:WaitForChild("Humanoid")
	hum:ApplyDescription(desc)

	Status.TextColor3 = Color3.fromRGB(120,255,120)
	Status.Text = "Skin copied successfully"
end

StealButton.MouseButton1Click:Connect(function()
	if NameBox.Text ~= "" then
		StealCharacter(NameBox.Text)
	end
end)

--// DRAG (PC + MOBILE)
do
	local dragging, startPos, startInput

	Title.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1
		or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			startInput = input.Position
			startPos = MainFrame.Position
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
		or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - startInput
			MainFrame.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)

	UIS.InputEnded:Connect(function()
		dragging = false
	end)
end
